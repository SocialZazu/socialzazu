<template name="editor">
  <div class="row-fluid">
    <div class="span6">
      <div class="row-fluid">
        {{#with resource_datums}}
        {{> edit_search_resources}}
        {{/with}}
      </div>
      <section class="well">
        {{#if has_needs_edit}}
        <div class="row-fluid">
        {{> needs_edit}}
        </div>
        {{else}}
        <h5>No Edits Reported</h5>
        {{/if}}
      </section>
      <section class="well">
        {{#if has_open_flags}}
        <div class="row-fluid">
        {{> open_flags}}
        </div>
        {{else}}
        <h5>No Open Flags</h5>
        {{/if}}
      </section>
    </div>
    <div class="span6">
      {{#if show_edit_resource}}
        {{#with resource}}
        {{> edit_resource}}
        {{/with}}
      {{else}}
      {{/if}}
    </div>
  </div>
</template>

<template name="edit_address">
  <div class="row-fluid edit_address" index="{{index}}">
    <div class="span3">
      Address
    </div>
    <div class="span4">
      {{#with toggle "street"}}
      {{> is_editing_toggle}}
      {{/with}}
    </div>
    <div class="span3">
      {{#with toggle "city"}}
      {{> is_editing_toggle}}
      {{/with}}
    </div>
    <div class="span2">
      {{#with toggle "zipcode"}}
      {{> is_editing_toggle}}
      {{/with}}
    </div>
  </div>
</template>

<template name="edit_buttons">
  {{#if is_editing}}
  <button type="submit" class="btn btn-small right" id="save_resource">Save</button>
  <button type="submit" class="btn btn-small left" id="cancel_edits">Cancel</button>
  {{else}}
  <button type="submit" class="btn btn-small left" id="edit_resource">Edit</button>
  <button type="submit" class="btn btn-small right" id="mark_complete">Mark Completed</button>
  {{/if}}
</template>

<template name="edit_field">
  <div class="row-fluid">
    <div class="span3">
      {{field}}:
    </div>
    <div class="span9">
      {{> is_editing_toggle toggle_info}}
    </div>
  </div>
  <br>
</template>

<template name="edit_hours">
  <div class="row-fluid">
    <div class="span3">
      Hours:
    </div>
    <div class="span1">Day</div>
    <div class="span2">Closed?</div>
    <div class="span3">Open Time</div>
    <div class="span3">Close Time</div>
  </div>
  {{> edit_hours_subfield m_f}}
  {{> edit_hours_subfield sat}}
  {{> edit_hours_subfield sun}}
</template>

<template name="edit_hours_subfield">
  <div class="row-fluid">
    <div class="span3"></div>
    <div class="span1">
      {{period_title}}:
    </div>
    <div class="span2">
      {{#if is_editing}}
      <input {{checked}} type="checkbox" id="{{period}}_checkbox" style="position:relative; left:20%; width:20px; height:20px">
      {{else}}
      {{closed_yes_no}}
      {{/if}}
    </div>
    {{#if closed}}
    <div class="span3">Closed</div>
    <div class="span3">Closed</div>
    {{else}}
    <div class="span3">
      {{#if is_editing}}
      <div class="input-group input-group-sm">
        <input style="width:42px" class="form-control" type="text" id="{{period}}_open" placeholder="{{open_placeholder}}">
      </div>
      {{else}}
      {{open_placeholder}}
      {{/if}}
    </div>
    <div class="span3">
      {{#if is_editing}}
      <div class="input-group input-group-sm">
        <input style="width:42px" class="form-control" type="text" id="{{period}}_close" placeholder="{{close_placeholder}}">
      </div>
      {{else}}
      {{close_placeholder}}
      {{/if}}
    </div>
    {{/if}}
  </div>
</template>

<template name="edit_resource">
  <div class="row-fluid">
    {{> edit_buttons}}
  </div>
  <div class="row-fluid" style="overflow-y:scroll; height:610px; margin-top:10px">
    {{> edit_field name}}
    {{> edit_sub_services sub_services}}
    {{> edit_field url}}
    {{> edit_field email}}
    {{#each contacts}} <!--TODO allow for removing contacts-->
    {{> edit_field contact_name}}
    {{> edit_field contact_title}}
    {{/each}}
    {{#each addresses}}
    {{> edit_address}}
    {{/each}}
    {{> edit_field short_desc}}
    {{> edit_field description}}
    {{> edit_hours hours}}
    {{> edit_field transportation}}
    {{> edit_field audience}}
    {{> edit_field eligibility}}
    {{> edit_field fees}}
    {{> edit_field how_to_apply}}
  </div>
</template>

<template name="edit_search_resources">
  {{> search_resources}}
</template>

<template name="edit_sub_services">
  <div class="row-fluid">
    <div class="span3">
      Categories:
    </div>
    <div class="span9">
      {{#if is_editing}}
      {{#each sub_services}}
      <a class="btn btn-default btn-small remove_service" style="margin-bottom:3px" href="#" id="{{_id}}">
        <i class="icon-remove"></i> {{name}}
      </a>
      {{/each}}
      {{#with sub_service_ids}}
      <div class="row-fluid" style="margin-top:{{margin_top}}">
        {{> select_service}}
      </div>
      {{/with}}
      {{else}}
      {{#each sub_services}}
      <a class="btn btn-default btn-small" href="#">
        {{name}}
      </a>
      {{/each}}
      {{/if}}
    </div>
</template>

<template name="is_editing_toggle">
  <div class="row-fluid">
    {{#if is_editing}}
    <input type="text" style="width:{{width}}" placeholder="{{current}}" id="{{id}}_input">
    {{else}}
    {{current}}
    {{/if}}
  </div>
</template>

<template name="needs_edit">
  <h5>In Need of Editing</h5>
  <div style="overflow-y:scroll; max-height:400px">
    {{#each resources}}
    {{> open_edit info_from_edit}}
    {{/each}}
  </div>
</template>

<template name="open_edit">
  <hr>
  <div class="row-fluid">
    {{#with resource}}
    <a style="font-size:110%" flag_or_edit="{{../type}}" resource_id="{{_id}}" href="#">{{name}}</a>
    {{/with}}
  </div>
</template>

<template name="open_flags">
  <h5>Open Flags</h5>
  <div style="overflow-y:scroll; max-height:400px">
    {{#each flags}}
    {{> open_edit info_from_flag}}
    {{/each}}
  </div>
</template>

<template name="select_service">
  <select class="form-control">
    <option value="instr">Add a Category</option>
    {{#each other_services}}
    <option value="{{_id}}">{{name}}</option>
    {{/each}}
  </select>
</template>
