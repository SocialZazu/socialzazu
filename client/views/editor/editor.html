<template name="editor">
  <div class="row-fluid">
    <div class="span6">
      <div class="row-fluid">
        <div class="span8">
          {{#with resource_datums}}
          {{> edit_search_resources}}
          {{/with}}
        </div>
        <div class="span4">
          <button type="submit" style="height:38px" id="new_resource" class="btn btn-default right">
            Add Resource
          </button>
        </div>
      </div>
      <section class="well">
        {{#if has_needs_edit}}
        <div class="row-fluid">
          <div class="span5">
            <h5>In Need of Editing</h5>
          </div>
          <div class="span7 right red">
            <h5>{{message}}</h5>
          </div>
        </div>
        <div class="row-fluid">
          {{> needs_edit}}
        </div>
        {{else}}
        <h5>No Edits Reported</h5>
        {{/if}}
      </section>
      <section class="well">
        {{#if has_open_flags}}
        <div class="row-fluid">
          <div class="span5">
            <h5>Open Flags</h5>
          </div>
          <div class="span7 right red">
            {{message}}
          </div>
        </div>
        <div class="row-fluid">
          {{> open_flags}}
        </div>
        {{else}}
        <h5>No Open Flags</h5>
        {{/if}}
      </section>
    </div>
    <div class="span6">
      {{#if show_edit_resource}}
        {{#with resource}}
        {{> edit_resource}}
        {{/with}}
      {{else}}
        {{> new_resource}}
      {{/if}}
    </div>
  </div>
</template>

<template name="edit_access">
  <div class="row-fluid">
    <div class="span3">
      Accessibility:
    </div>
    <div class="span9">
      {{#if is_editing}}
      {{#each accessibles}}
      <a class="btn btn-default btn-small remove_access" style="margin-bottom:3px" href="#" id="{{this}}">
        <i class="icon-remove"></i> {{capitalize this}}
      </a>
      {{/each}}
      <div class="row-fluid" style="margin-top:{{margin_top}}">
        <select class="form-control">
          <option value="instr">Add Accessibility</option>
          {{#each other_access}}
          <option value="{{this}}">{{capitalize this}}</option>
          {{/each}}
        </select>
      </div>
      {{else}}
      {{#each accessibles}}
      <a class="btn btn-default btn-small" href="#">
        {{capitalize this}}
      </a>
      {{/each}}
      {{/if}}
    </div>
</template>

<template name="edit_address">
  <div class="row-fluid edit_address" index="{{index}}">
    <div class="span3 {{field_name}}">
      Address:
    </div>
    <div class="span4">
      {{#with toggle "street"}}
      {{> is_editing_toggle}}
      {{/with}}
    </div>
    <div class="span3">
      {{#with toggle "city"}}
      {{> is_editing_toggle}}
      {{/with}}
    </div>
    <div class="span2">
      {{#with toggle "zipcode"}}
      {{> is_editing_toggle}}
      {{/with}}
    </div>
  </div>
</template>

<template name="edit_buttons">
  <div class="row-fluid">
    {{#if is_editing}}
    <div class="span3">
      <button type="submit" class="btn btn-small left" id="cancel_edits">Cancel</button>
    </div>
    <div class="span6">
      {{> message}}
    </div>
    <div class="span3">
      <button type="submit" class="btn btn-small right" id="save_resource">Save</button>
    </div>
    {{else}}
    <div class="span3">
      <button type="submit" class="btn btn-small left" id="edit_resource">Edit</button>
    </div>
    <div class="span6">
      {{> message}}
    </div>
  </div>
    <div class="span3">
      <button type="submit" class="btn btn-small right" id="mark_complete">Looks Good</button>
    </div>
    {{/if}}
  </div>
</template>

<template name="edit_field">
  <div class="row-fluid">
    <div class="span3 {{field_name}}">
      {{field}}:
    </div>
    <div class="span9">
      {{> is_editing_toggle toggle_info}}
    </div>
  </div>
</template>

<template name="edit_hours">
  <div class="row-fluid">
    <div class="span3">
      Hours:
    </div>
    <div class="span2">Day</div>
    <div class="span2">Closed?</div>
    <div class="span3">Open Time</div>
    <div class="span2">Close Time</div>
  </div>
  {{> edit_hours_subfield m_f}}
  {{> edit_hours_subfield sat}}
  {{> edit_hours_subfield sun}}
</template>

<template name="edit_hours_subfield">
  <div class="row-fluid">
    <div class="span2 offset3">
      {{period_title}}:
    </div>
    <div class="span2">
      {{#if is_editing}}
      <input {{checked}} type="checkbox" id="{{period}}_checkbox" style="position:relative; left:20%; width:20px; height:20px">
      {{else}}
      <span style="position:relative; left:20%">
        {{closed_yes_no}}
      </span>
      {{/if}}
    </div>
    <div class="span3">
      {{#if is_editing}}
      <input style="width:42px; height:12px" class="form-control" type="text" id="{{period}}_open" placeholder="{{open_placeholder}}">
      {{else}}
      {{open_placeholder}}
      {{/if}}
    </div>
    <div class="span2">
      {{#if is_editing}}
      <input style="width:42px; height:12px" class="form-control" type="text" id="{{period}}_close" placeholder="{{close_placeholder}}">
      {{else}}
      {{close_placeholder}}
      {{/if}}
    </div>
  </div>
</template>

<template name="edit_languages">
  <div class="row-fluid">
    <div class="span3">
      Languages:
    </div>
    <div class="span9">
    {{#if is_editing}}
      {{#each languages}}
      <a class="btn btn-default btn-small remove_language" style="margin-bottom:3px" href="#" name="{{this}}">
        <i class="icon-remove"></i> {{this}}
      </a>
      {{/each}}
      <div class="row-fluid">
        <div class="span9">
          <input class="form-control" type="text" id="language_input" placeholder="Add a Language" style="width:80%">
        </div>
        <div class="span3 left">
          <button type="submit" class="btn btn-primary" id="add_language">Add</button>
        </div>
      </div>
    {{else}}
      {{#each languages}}
      <a class="btn btn-default btn-small" href="#">
        {{this}}
      </a>
      {{/each}}
    {{/if}}
    </div>
  </div>
</template>

<template name="edit_phone">
  <div class="row-fluid edit_phone" index="{{index}}">
    <div class="span3 {{field_name}}">
      Phone:
    </div>
    <div class="span3">
      {{#with toggle "phone_number"}}
      {{> is_editing_toggle}}
      {{/with}}
    </div>
    <div class="span6">
      {{#with toggle "phone_hours"}}
      {{> is_editing_toggle}}
      {{/with}}
    </div>
  </div>
</template>

<template name="edit_resource">
  <div class="box-wrapper">
    <div class="box">
      <div class="controls-wrapper highcontrols-wrapper">
        {{> edit_buttons}}
        <hr>
        <div class="row-fluid" style="overflow-y:scroll; height:530px; margin-top:10px">
          {{> edit_field name}}
          {{> edit_field url}}
          {{> edit_field email}}
          {{#each contacts}} <!--TODO allow for removing contacts-->
          {{> edit_field contact_name}}
          {{> edit_field contact_title}}
          {{/each}}
          {{#each phones}}
          {{> edit_phone}}
          {{/each}}
          {{#each addresses}}
          {{> edit_address}}
          {{/each}}
          {{> edit_sub_services sub_services}}
          {{> edit_access accessibility_inputs}}
          {{> edit_languages languages}}
          {{> edit_field short_desc}}
          {{> edit_field description}}
          {{> edit_hours hours}}
          {{> edit_field transportation}}
          {{> edit_field audience}}
          {{> edit_field eligibility}}
          {{> edit_field fees}}
          {{> edit_field how_to_apply}}
          {{#each category_specific_input}}
          {{> category_input}}
          {{/each}}
        </div>
      </div>
    </div>
  </div>
</template>

<template name="edit_search_resources">
  {{> search_resources}}
</template>

<template name="edit_sub_services">
  <div class="row-fluid">
    <div class="span3">
      Categories:
    </div>
    <div class="span9">
      {{#if is_editing}}
      {{#each sub_services}}
      <a class="btn btn-default btn-small remove_service" style="margin-bottom:3px" href="#" id="{{_id}}">
        <i class="icon-remove"></i> {{name}}
      </a>
      {{/each}}
      {{#with sub_service_ids}}
      <div class="row-fluid" style="margin-top:{{margin_top}}">
        {{> select_service}}
      </div>
      {{/with}}
      {{else}}
      {{#each sub_services}}
      <a class="btn btn-default btn-small" href="#">
        {{name}}
      </a>
      {{/each}}
      {{/if}}
    </div>
</template>

<template name="is_editing_toggle">
  <div class="row-fluid">
    {{#if is_editing}}
    <input type="text" style="width:{{width}}" placeholder="{{current}}" id="{{id}}_input">
    {{else}}
    {{current}}
    {{/if}}
  </div>
</template>

<template name="message">
  <span class="red">
    {{message}}
  </span>
</template>

<template name="needs_edit">
  <div style="overflow-y:scroll; max-height:400px">
    {{#each resources}}
    {{> open_edit info_from_edit}}
    {{/each}}
  </div>
</template>

<template name="new_field"> <!-- TODO: convert to using edit_field -->
  <div class="row-fluid">
    <div class="span3 field_name">
      {{field}}:
    </div>
    <div class="span9">
      <input type="text" style="width:92%" id="{{id}}">
    </div>
  </div>
</template>

<template name="new_resource">
  <div class="box-wrapper">
    <div class="box">
      <div class="controls-wrapper highcontrols-wrapper">
        <div class="row-fluid">
          <div class="span3">
            <span class="left" style="font-size:larger">New</span>
          </div>
          <div class="span7">
            {{> message}}
          </div>
          <div class="span2">
            <button type="submit" class="btn btn-small right" id="save_resource">Save</button>
          </div>
        </div>
        <hr>
        <div class="row-fluid" style="overflow-y:scroll; height:530px; margin-top:10px">
          {{> new_field name}}
          {{> new_field url}}
          {{> new_field email}}
          {{> new_field contact_name}}
          {{> new_field contact_title}}
          {{> edit_phone blank_phone}}
          {{#with blank_address}}
          {{> edit_address}}
          {{/with}}
          {{> edit_sub_services sub_services}}
          {{> edit_access accessibility_inputs}}
          {{> edit_languages languages}}
          {{> new_field short_desc}}
          {{> new_field description}}
          {{> edit_hours blank_dict}}
          {{> new_field transportation}}
          {{> new_field audience}}
          {{> new_field eligibility}}
          {{> new_field fees}}
          {{> new_field how_to_apply}}
          {{#each category_specific_input}}
          {{> category_input}}
          {{/each}}
        </div>
      </div>
    </div>
  </div>
</template>

<template name="open_edit">
  <hr>
  <div class="row-fluid">
    {{#with resource}}
    <a style="font-size:110%" flag_or_edit="{{../type}}" resource_id="{{_id}}" href="#">{{name}}</a>
    {{/with}}
  </div>
</template>

<template name="open_flags">
  <div style="overflow-y:scroll; max-height:400px">
    {{#each flags}}
    {{> open_edit info_from_flag}}
    {{/each}}
  </div>
</template>

<template name="select_service">
  <select class="form-control">
    <option value="instr">Add a Category</option>
    {{#each other_services}}
    <option value="{{_id}}">{{name}}</option>
    {{/each}}
  </select>
</template>
